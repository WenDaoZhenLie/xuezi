## **代理模式**
---
### ***静态代理***
```java
```
### ***动态代理***
`Java`
#### **JDK代理(接口代理)**
1. Proxy
   ```java
   public class Proxy implements java.io.Serializable {
        protected Proxy(InvocationHandler h) {
            Objects.requireNonNull(h);
            this.h = h;
        }
        public static Object newProxyInstance(ClassLoader loader, Class<?>[] interfaces, InvocationHandler h){
            Objects.requireNonNull(h);
            final Class<?>[] intfs = interfaces.clone();
            final SecurityManager sm = System.getSecurityManager();
            if (sm != null) {
                checkProxyAccess(Reflection.getCallerClass(), loader, intfs);
            }
            // 获取代理类
            Class<?> cl = getProxyClass0(loader, intfs);
            try {
                if (sm != null) {
                    checkNewProxyPermission(Reflection.getCallerClass(), cl);
                }
                final Constructor<?> cons = cl.getConstructor(constructorParams);
                final InvocationHandler ih = h;
                if (!Modifier.isPublic(cl.getModifiers())) {
                    AccessController.doPrivileged(new PrivilegedAction<Void>() {
                        public Void run() {
                            cons.setAccessible(true);
                            return null;
                        }
                    });
                }
                // 代理对象
                return cons.newInstance(new Object[]{h});
            } catch (IllegalAccessException|InstantiationException e) {
                throw new InternalError(e.toString(), e);
            } catch (InvocationTargetException e) {
                Throwable t = e.getCause();
                if (t instanceof RuntimeException) {
                    throw (RuntimeException) t;
                } else {
                    throw new InternalError(t.toString(), t);
                }
            } catch (NoSuchMethodException e) {
                throw new InternalError(e.toString(), e);
            }
        }
   }
   ```
2. Invocationhandler
   ```java
   public interface InvocationHandler {
        public Object invoke(Object proxy, Method method, Object[] args){
            throws Throwable;
        }
   }
   ```
3. ProxyMethod
   ```java
   private class ProxyMethod {
       public String methodName;
       public Class<?>[] parameterTypes;
       public Class<?> returnType;
       public Class<?>[] exceptionTypes;
       public Class<?> fromClass;
       public String methodFieldName;
       private ProxyMethod(String var2, Class<?>[] var3, Class<?> var4, Class<?>[] var5, Class<?> var6) {
           this.methodName = var2;
           this.parameterTypes = var3;
           this.returnType = var4;
           this.exceptionTypes = var5;
           this.fromClass = var6;
           this.methodFieldName = "m" + ProxyGenerator.this.proxyMethodCount++;
       }
   }
   ```
#### **CGLIB代理(子类代理)**

## **装饰器模式**
`python`
```python
# 函数装饰器
# func = decorator(func)
def decorator(func):
    def wrapper(*args, **kwargs):
        print("Before func is called")
        result = func(*args, **kwargs)
        print("After func is called")
        return result
    return wrapper

@decorator
def func(*args, **kwargs):
    print("Inside the func")

# 类装饰器
# func = ClassDecorator(func)
class ClassDecorator:
    def __init__(self, func):
        self.func = func

    def __call__(self, *args, **kwargs):
        print("Before func is called")
        result = self.func(*args, **kwargs)
        print("After func is called")
        return result

@ClassDecorator
def func(*args, **kwargs):
    print("Inside the func")

# 对象装饰器
# func = ObjectDecorator(*args, **kwargs)(func) 
class ObjectDecorator:
    def __init__(self, *args, **kwargs):
        self.args = args
        self.kwargs = kwargs

    def __call__(self, func):
        def wrapper(*args, **kwargs):
            print("Before func is called")
            func(*args, **kwargs)
            print("After func is called")
        return wrapper

@ObjectDecorator(*args, **kwargs)
def func(*args, **kwargs):
    print("Inside the func")
```